<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Music Player</title>
</head>
<body>
    <audio id="bgMusic" loop>
        <source src="wedding-music.mp3" type="audio/mpeg">
    </audio>

    <script>
        var bgMusic = document.getElementById('bgMusic');
        var hasStarted = false;

        // Get saved music state and time
        var musicState = sessionStorage.getItem('musicPlaying');
        var savedTime = parseFloat(sessionStorage.getItem('musicTime') || '0');

        // Set the saved time
        bgMusic.currentTime = savedTime;

        // Function to start music
        function startMusic() {
            if (!hasStarted) {
                bgMusic.play().then(function() {
                    hasStarted = true;
                    sessionStorage.setItem('musicPlaying', 'true');
                    console.log('Music started successfully');
                }).catch(function(error) {
                    console.log('Autoplay prevented:', error);
                });
            } else if (musicState !== 'false') {
                bgMusic.play().catch(function(error) {
                    console.log('Play prevented:', error);
                });
            }
        }

        // Try to play immediately (works on desktop)
        startMusic();

        // Save time every second
        setInterval(function () {
            if (!bgMusic.paused) {
                sessionStorage.setItem('musicTime', bgMusic.currentTime);
            }
        }, 1000);

        // Listen for commands from parent pages
        window.addEventListener('message', function (event) {
            if (event.data === 'startMusic') {
                // Force start music when envelope is clicked
                startMusic();
            } else if (event.data === 'toggleMusic') {
                if (bgMusic.paused) {
                    bgMusic.play();
                    sessionStorage.setItem('musicPlaying', 'true');
                    event.source.postMessage({ musicPlaying: true }, '*');
                } else {
                    bgMusic.pause();
                    sessionStorage.setItem('musicPlaying', 'false');
                    event.source.postMessage({ musicPlaying: false }, '*');
                }
            } else if (event.data === 'getMusicState') {
                event.source.postMessage({
                    musicPlaying: !bgMusic.paused
                }, '*');
            }
        });

        // Save time before page unload
        window.addEventListener('beforeunload', function () {
            sessionStorage.setItem('musicTime', bgMusic.currentTime);
        });
    </script>
</body>
</html>



























